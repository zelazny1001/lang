import pandas as pd
from openpyxl import Workbook
from openpyxl.utils.dataframe import dataframe_to_rows

# Set paths
input_csv_path = "/my/root/location/filename.csv"
output_excel_path = "/my/root/location/filename.xlsx"

# Extract filename without extension for worksheet name
worksheet_name = input_csv_path.split('/')[-1].split('.')[0]

# Load CSV and filter columns
df = pd.read_csv(input_csv_path)
filtered_df = df[["Branch", "Intent", "Utterance"]]  # Directly use "Utterance" as the column name

# Write to Excel with OpenPyXL to apply formatting
wb = Workbook()
ws = wb.active
ws.title = worksheet_name

# Append rows to worksheet
for row in dataframe_to_rows(filtered_df, index=False, header=True):
    ws.append(row)

# Freeze the top row
ws.freeze_panes = "A2"

# Add filters to each column
ws.auto_filter.ref = ws.dimensions

# Save to Excel file
wb.save(output_excel_path)